<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple POS System with History</title>
    <style>
        .product-button {
            display: inline-block;
            margin: 5px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        .product-button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <h1>Simple POS System</h1>

    <h2>Products</h2>
    <div>
        <button class="product-button" onclick="addItem('Brioche', 140)">Brioche - ฿140</button>
        <button class="product-button" onclick="addItem('Bagel', 45)">Bagel - ฿45</button>
        <button class="product-button" onclick="addItem('Bagel creamcheese', 60)">Bagel creamcheese - ฿60</button>
        <button class="product-button" onclick="addItem('Bagel cranberry creamcheese', 60)">Bagel cranberry creamcheese - ฿60</button>
        <button class="product-button" onclick="addItem('Sourdough S', 130)">Sourdough S - ฿130</button>
        <button class="product-button" onclick="addItem('SD walnut cranberry', 145)">SD walnut cranberry - ฿145</button>
        <button class="product-button" onclick="addItem('SD olive', 145)">SD olive - ฿145</button>
        <button class="product-button" onclick="addItem('Focaccia', 80)">Focaccia - ฿80</button>
        <button class="product-button" onclick="addItem('Focaccia bacon', 80)">Focaccia bacon - ฿80</button>
        <button class="product-button" onclick="addItem('Focaccia Pesto', 80)">Focaccia Pesto - ฿80</button>
        <button class="product-button" onclick="addItem('Focaccia PP', 80)">Focaccia PP - ฿80</button>
        <button class="product-button" onclick="addItem('Baguette', 45)">Baguette - ฿45</button>
        <button class="product-button" onclick="addItem('Baguette veal', 95)">Baguette veal - ฿95</button>
        <button class="product-button" onclick="addItem('Baguette cheese', 95)">Baguette cheese - ฿95</button>
        <button class="product-button" onclick="addItem('Tofu Milk', 15)">Tofu Milk - ฿15</button>
        <button class="product-button" onclick="addItem('BNB', 40)">BNB - ฿40</button>
    </div>

    <div>
        <label>Quantity:</label>
        <input type="number" id="quantity" value="1" min="1">
    </div>
    <h2>Cart</h2>
    <table id="cartTable" border="1">
        <tr>
            <th>Product</th>
            <th>Unit Price</th>
            <th>Quantity</th>
            <th>Total</th>
            <th>Actions</th>
        </tr>
    </table>
    <h3>Total: ฿<span id="totalAmount">0</span></h3>
    <button onclick="checkout()">Checkout</button>
    <button onclick="voidTransaction()">Void</button> <!-- New Void Button -->

    <h2>Transaction History</h2>
    <div id="historySection">No transaction history.</div>
    <button onclick="clearHistory()">Clear History</button>

    <script>
        let total = 0;
        let cartItems = [];

        // Load history from local storage on page load
        window.onload = function() {
            displayHistory();
        };

        function addItem(productName, unitPrice) {
            const quantity = parseInt(document.getElementById("quantity").value);
            const totalPrice = unitPrice * quantity;

            // Check if the item already exists in the cart
            const existingItemIndex = cartItems.findIndex(item => item.productName === productName);

            if (existingItemIndex > -1) {
                // Update existing item
                const existingItem = cartItems[existingItemIndex];
                existingItem.quantity += quantity;
                existingItem.totalPrice += totalPrice;

                // Update total amount
                total += totalPrice;

                // Update the cart table row
                const row = document.getElementById(`item-${existingItemIndex}`);
                row.cells[2].innerText = existingItem.quantity;
                row.cells[3].innerText = "฿" + existingItem.totalPrice;

            } else {
                // Add new item to cart
                total += totalPrice;
                cartItems.push({ productName, unitPrice, quantity, totalPrice });

                // Add item to cart table
                const cartTable = document.getElementById("cartTable");
                const row = cartTable.insertRow();
                row.id = `item-${cartItems.length - 1}`; // Assign an ID for easy access
                row.insertCell(0).innerText = productName;
                row.insertCell(1).innerText = "฿" + unitPrice;
                row.insertCell(2).innerText = quantity;
                row.insertCell(3).innerText = "฿" + totalPrice;

                // Add action buttons for quantity adjustment
                const actionsCell = row.insertCell(4);
                actionsCell.innerHTML = `
                    <button onclick="adjustQuantity(${cartItems.length - 1}, -1)">-</button>
                    <button onclick="adjustQuantity(${cartItems.length - 1}, 1)">+</button>
                `;
            }

            // Update total amount displayed
            document.getElementById("totalAmount").innerText = total;
        }

        function adjustQuantity(index, change) {
            const item = cartItems[index];
            const newQuantity = item.quantity + change;

            if (newQuantity < 1) return; // Prevent quantity from going below 1

            // Update quantity and total price
            item.quantity = newQuantity;
            item.totalPrice = item.unitPrice * newQuantity;

            // Update total amount
            total = cartItems.reduce((sum, item) => sum + item.totalPrice, 0);
            document.getElementById("totalAmount").innerText = total;

            // Update the cart table
            const row = document.getElementById(`item-${index}`);
            row.cells[2].innerText = item.quantity;
            row.cells[3].innerText = "฿" + item.totalPrice;
        }

        function checkout() {
            if (cartItems.length === 0) {
                alert("Cart is empty!");
                return;
            }

            // Save transaction to history
            const transaction = {
                id: Date.now(),
                date: new Date().toLocaleString(),
                items: cartItems,
                total: total
            };

            let history = JSON.parse(localStorage.getItem("transactionHistory")) || [];
            history.push(transaction);
            localStorage.setItem("transactionHistory", JSON.stringify(history));

            // Alert and reset cart
            alert("Total Payment: ฿" + total + "\nThank you for your purchase!");
            resetCart();

            // Display updated history
            displayHistory();
        }

        function voidTransaction() {
            if (cartItems.length === 0) {
                alert("Cart is already empty!");
                return;
            }

            // Reset cart without saving
            resetCart();
            alert("Transaction voided.");
        }

        function displayHistory() {
            const historySection = document.getElementById("historySection");
            historySection.innerHTML = ""; // Clear previous history

            const history = JSON.parse(localStorage.getItem("transactionHistory")) || [];
            if (history.length === 0) {
                historySection.innerText = "No transaction history.";
                return;
            }

            history.forEach(transaction => {
                const div = document.createElement("div");
                div.innerHTML = `<strong>Date:</strong> ${transaction.date} | <strong>Total:</strong> ฿${transaction.total}`;

                const ul = document.createElement("ul");
                transaction.items.forEach(item => {
                    const li = document.createElement("li");
                    li.innerText = `${item.productName} - ฿${item.unitPrice} x ${item.quantity} = ฿${item.totalPrice}`;
                    ul.appendChild(li);
                });

                div.appendChild(ul);
                historySection.appendChild(div);
                historySection.appendChild(document.createElement("hr"));
            });
        }

        function clearHistory() {
            localStorage.removeItem("transactionHistory");
            displayHistory();
        }

        function resetCart() {
            document.getElementById("cartTable").innerHTML = `
                <tr>
                    <th>Product</th>
                    <th>Unit Price</th>
                    <th>Quantity</th>
                    <th>Total</th>
                    <th>Actions</th>
                </tr>`;
            total = 0;
            cartItems = [];
            document.getElementById("totalAmount").innerText = total;
        }
    </script>
</body>
</html>
