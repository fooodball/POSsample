<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple POS System with History</title>
</head>
<body>
    <h1>Simple POS System</h1>
    <!-- Product selection -->
    <div>
        <label>Product:</label>
        <select id="productSelect">
            <option value="140">Brioche - ฿140</option>
            <option value="60">Bagel - ฿60</option>
            <option value="130">Sourdough - ฿130</option>
            <option value="80">Focaccia - ฿80</option>
            <option value="45">Baguette - ฿45</option>
            <option value="15">Tofu Milk - ฿15</option>
            <option value="40">BNB - ฿40</option>
        </select>
    </div>
    <div>
        <label>Quantity:</label>
        <input type="number" id="quantity" value="1" min="1">
    </div>
    <button onclick="addItem()">Add to Cart</button>

    <h2>Cart</h2>
    <table id="cartTable" border="1">
        <tr>
            <th>Product</th>
            <th>Unit Price</th>
            <th>Quantity</th>
            <th>Total</th>
        </tr>
    </table>
    <h3>Total: ฿<span id="totalAmount">0</span></h3>
    <button onclick="checkout()">Checkout</button>

    <h2>Transaction History</h2>
    <div id="historySection">No transaction history.</div>
    <button onclick="clearHistory()">Clear History</button>

    <script>
        let total = 0;
        let cartItems = [];

        // Load history from local storage on page load
        window.onload = function() {
            displayHistory();
        };

        function addItem() {
            const productSelect = document.getElementById("productSelect");
            const quantity = parseInt(document.getElementById("quantity").value);
            const unitPrice = parseInt(productSelect.value);
            const productName = productSelect.options[productSelect.selectedIndex].text.split(" - ")[0];
            const totalPrice = unitPrice * quantity;

            // Check if the item already exists in the cart
            const existingItemIndex = cartItems.findIndex(item => item.productName === productName);

            if (existingItemIndex > -1) {
                // Update existing item
                const existingItem = cartItems[existingItemIndex];
                existingItem.quantity += quantity;
                existingItem.totalPrice += totalPrice;

                // Update total amount
                total += totalPrice;
                document.getElementById("totalAmount").innerText = total;

                // Update the cart table row
                const row = document.getElementById(`item-${existingItemIndex}`);
                row.cells[2].innerText = existingItem.quantity;
                row.cells[3].innerText = "฿" + existingItem.totalPrice;

         } else {
                // Add new item to cart
            total += totalPrice;
            cartItems.push({ productName, unitPrice, quantity, totalPrice });

            // Add item to cart table
            const cartTable = document.getElementById("cartTable");
            const row = cartTable.insertRow();
            row.insertCell(0).innerText = productName;
            row.insertCell(1).innerText = "฿" + unitPrice;
            row.insertCell(2).innerText = quantity;
            row.insertCell(3).innerText = "฿" + totalPrice;

            // Update total amount displayed
            document.getElementById("totalAmount").innerText = total;
        }

        function checkout() {
            if (cartItems.length === 0) {
                alert("Cart is empty!");
                return;
            }

            // Save transaction to history
            const transaction = {
                id: Date.now(),
                date: new Date().toLocaleString(),
                items: cartItems,
                total: total
            };

            let history = JSON.parse(localStorage.getItem("transactionHistory")) || [];
            history.push(transaction);
            localStorage.setItem("transactionHistory", JSON.stringify(history));

            // Alert and reset cart
            alert("Total Payment: ฿" + total + "\nThank you for your purchase!");
            resetCart();

            // Display updated history
            displayHistory();
        }

        function displayHistory() {
            const historySection = document.getElementById("historySection");
            historySection.innerHTML = ""; // Clear previous history

            const history = JSON.parse(localStorage.getItem("transactionHistory")) || [];
            if (history.length === 0) {
                historySection.innerText = "No transaction history.";
                return;
            }

            history.forEach(transaction => {
                const div = document.createElement("div");
                div.innerHTML = `<strong>Date:</strong> ${transaction.date} | <strong>Total:</strong> ฿${transaction.total}`;

                const ul = document.createElement("ul");
                transaction.items.forEach(item => {
                    const li = document.createElement("li");
                    li.innerText = `${item.productName} - ฿${item.unitPrice} x ${item.quantity} = ฿${item.totalPrice}`;
                    ul.appendChild(li);
                });

                div.appendChild(ul);
                historySection.appendChild(div);
                historySection.appendChild(document.createElement("hr"));
            });
        }

        function clearHistory() {
            localStorage.removeItem("transactionHistory");
            displayHistory();
        }

        function resetCart() {
            document.getElementById("cartTable").innerHTML = `
                <tr>
                    <th>Product</th>
                    <th>Unit Price</th>
                    <th>Quantity</th>
                    <th>Total</th>
                </tr>`;
            total = 0;
            cartItems = [];
            document.getElementById("totalAmount").innerText = total;
        }
    </script>
</body>
</html>
